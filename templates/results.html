{% extends 'base.html' %}

{% block head %}
  <title>Email Analysis Report</title>
{% endblock %}

{% block body %}
<div class="flex justify-center py-10 px-4">
  <div class="card bg-base-100 shadow-2xl w-full max-w-4xl p-8 space-y-8">

    <!-- Title -->
    <div class="text-center">
      <h2 class="text-3xl font-extrabold tracking-tight text-white">Email Fraud Detection Report</h2>
      <p class="text-sm text-gray-400 mt-1">Detailed analysis and prediction outcome</p>
    </div>

    <!-- Metadata -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm bg-base-200 rounded-lg p-4">
      <div><strong>From:</strong> <span class="text-white">{{ sender }}</span></div>
      {% if subject %}
      <div><strong>Subject:</strong> <span class="text-white">{{ subject }}</span></div>
      {% endif %}
      <div><strong>Contains URL:</strong> {{ 'Yes' if contains_url else 'No' }}</div>
      <div><strong>Score:</strong> {{ probability | round(3) if probability is not none else "N/A" }}</div>
    </div>

    <!-- Verdict Section -->
    <div class="rounded-lg p-4 {{ 
        'bg-error/20 border-l-4 border-error text-error' if is_fraud else 
        'bg-success/20 border-l-4 border-success text-success' if final_prediction == 0 else 
        'bg-warning/20 border-l-4 border-warning text-warning' 
      }}">
      <strong>Prediction:</strong>
      {{ 'FRAUDULEUX' if is_fraud else 'L√âGITIME' if final_prediction == 0 else 'SUSPECIOUS (manual review)' }}
    </div>

    <!-- Original Email -->
    <div>
      <h3 class="text-xl font-bold border-b border-base-300 pb-2 mb-2">Original Email Body</h3>
      <div class="bg-base-200 p-4 rounded text-sm whitespace-pre-wrap text-white shadow-inner">{{ body }}</div>
    </div>

    <!-- Extracted URLs -->
    {% if urls and urls|length > 0 %}
    <div>
      <h3 class="text-xl font-bold border-b border-base-300 pb-2 mb-2">üîó Extracted URLs</h3>
      <ul class="list-disc list-inside text-sm space-y-1">
        {% for url in urls %}
          <li class="break-all text-white">{{ url }}</li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}

    <!-- Full Report -->
    {% if report %}
    <div>
      <h3 class="text-xl font-bold border-b border-base-300 pb-2 mb-2"> Detailed Report</h3>
      <pre class="bg-base-200 p-4 rounded text-sm whitespace-pre-wrap text-white">{{ report }}</pre>
    </div>
    {% endif %}

    <!-- Back -->
    <div class="text-center pt-4">
      <a href="/" class="btn btn-outline btn-wide">‚Üê Back to History</a>
    </div>

  </div>
</div>
{% endblock %}
